<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>兿芝梅 | dll、node http/express的理解和实践</title>
    <meta name="description" content="只有出发，总会到达；只有出发，才会到达！">
    <link rel="shortcut icon" href="/my-blog/images/favicon.ico">
  <link rel="stylesheet" href="/my-blog/style/style.css">
    
    <link rel="preload" href="/my-blog/assets/css/0.styles.5f45b4cf.css" as="style"><link rel="preload" href="/my-blog/assets/js/app.c2d9e473.js" as="script"><link rel="preload" href="/my-blog/assets/js/28.52366dcf.js" as="script"><link rel="prefetch" href="/my-blog/assets/js/12.b65eeaca.js"><link rel="prefetch" href="/my-blog/assets/js/1.6af14080.js"><link rel="prefetch" href="/my-blog/assets/js/2.f42c9f7c.js"><link rel="prefetch" href="/my-blog/assets/js/3.8f949e85.js"><link rel="prefetch" href="/my-blog/assets/js/4.9182cef7.js"><link rel="prefetch" href="/my-blog/assets/js/5.126c2f99.js"><link rel="prefetch" href="/my-blog/assets/js/6.1b5fb8e6.js"><link rel="prefetch" href="/my-blog/assets/js/7.dc92a253.js"><link rel="prefetch" href="/my-blog/assets/js/8.cb150767.js"><link rel="prefetch" href="/my-blog/assets/js/9.32ac0e16.js"><link rel="prefetch" href="/my-blog/assets/js/10.b8201a53.js"><link rel="prefetch" href="/my-blog/assets/js/11.b643f08e.js"><link rel="prefetch" href="/my-blog/assets/js/13.35a88c4f.js"><link rel="prefetch" href="/my-blog/assets/js/14.ea10057d.js"><link rel="prefetch" href="/my-blog/assets/js/15.df7b61cd.js"><link rel="prefetch" href="/my-blog/assets/js/16.b6ea61ef.js"><link rel="prefetch" href="/my-blog/assets/js/17.0160ad15.js"><link rel="prefetch" href="/my-blog/assets/js/18.0ea8fc9c.js"><link rel="prefetch" href="/my-blog/assets/js/19.19d9f7cb.js"><link rel="prefetch" href="/my-blog/assets/js/20.83956e73.js"><link rel="prefetch" href="/my-blog/assets/js/21.d5debcd2.js"><link rel="prefetch" href="/my-blog/assets/js/22.5775891a.js"><link rel="prefetch" href="/my-blog/assets/js/23.d8aae8c9.js"><link rel="prefetch" href="/my-blog/assets/js/24.ef9a0cac.js"><link rel="prefetch" href="/my-blog/assets/js/25.1792055b.js"><link rel="prefetch" href="/my-blog/assets/js/26.888914a2.js"><link rel="prefetch" href="/my-blog/assets/js/27.60395760.js"><link rel="prefetch" href="/my-blog/assets/js/29.1c1535cf.js"><link rel="prefetch" href="/my-blog/assets/js/30.2df652a7.js"><link rel="prefetch" href="/my-blog/assets/js/31.dcb81cda.js"><link rel="prefetch" href="/my-blog/assets/js/32.3ddb4e3d.js"><link rel="prefetch" href="/my-blog/assets/js/33.f88e1280.js"><link rel="prefetch" href="/my-blog/assets/js/34.37afa23d.js"><link rel="prefetch" href="/my-blog/assets/js/35.809fead5.js">
    <link rel="stylesheet" href="/my-blog/assets/css/0.styles.5f45b4cf.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/my-blog/" class="home-link router-link-active"><!----><span class="site-name">
      兿芝梅
    </span></a><div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><nav class="nav-links can-hide"><div class="nav-item"><a href="/my-blog/" class="nav-link">Home</a></div><div class="nav-item"><a href="/my-blog/frontEnd/" class="nav-link router-link-active">前端之路</a></div><div class="nav-item"><a href="/my-blog/life/" class="nav-link">平凡之路</a></div><div class="nav-item"><a href="https://github.com/arieltlm/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><!----></nav></div></header><div class="sidebar-mask"></div><div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/my-blog/" class="nav-link">Home</a></div><div class="nav-item"><a href="/my-blog/frontEnd/" class="nav-link router-link-active">前端之路</a></div><div class="nav-item"><a href="/my-blog/life/" class="nav-link">平凡之路</a></div><div class="nav-item"><a href="https://github.com/arieltlm/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><!----></nav><ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading open"><span>前端日常</span><span class="arrow down"></span></p><ul class="sidebar-group-items"><li><a href="/my-blog/frontEnd/front-daily/" class="sidebar-link">es6编程风格</a></li><li><a href="/my-blog/frontEnd/front-daily/one.html" class="sidebar-link">daterangepicker 使用及小bug修复</a></li><li><a href="/my-blog/frontEnd/front-daily/two.html" class="sidebar-link">更换&lt;input type=&quot;checkbox&quot;&gt;的样式</a></li><li><a href="/my-blog/frontEnd/front-daily/three.html" class="sidebar-link">solarSystem与“穿透能力”pointer-event</a></li><li><a href="/my-blog/frontEnd/front-daily/four.html" class="sidebar-link">《css揭秘》学习笔记</a></li><li><a href="/my-blog/frontEnd/front-daily/webpack-fe-ml.html" class="sidebar-link">cytoscape-fe-ml webpack配置理解</a></li><li><a href="/my-blog/frontEnd/front-daily/five.html" class="active sidebar-link">dll、node http/express的理解和实践</a></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>vue 故事</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>react大事</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>项目相随</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>折腾折腾</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>碎片时间</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>工具收藏</span><span class="arrow right"></span></p><!----></div></li></ul></div><div class="page"><div class="content"><h1 id="dll、node-http-express的理解和实践"><a href="#dll、node-http-express的理解和实践" aria-hidden="true" class="header-anchor">#</a> dll、node http/express的理解和实践</h1><blockquote><p>20190115</p></blockquote><p></p><div class="table-of-contents"><ul><li><a href="#_1-dll-（动态链接库）打包原理">1.dll （动态链接库）打包原理</a></li><li><a href="#_2-node-http起服务">2. node http起服务</a><ul><li><a href="#http起本地文件服务">http起本地文件服务</a></li><li><a href="#http代理服务">http代理服务</a></li><li><a href="#基础知识补充">基础知识补充</a></li></ul></li><li><a href="#_3-express起服务">3. express起服务</a></li></ul></div><p></p><h2 id="_1-dll-（动态链接库）打包原理"><a href="#_1-dll-（动态链接库）打包原理" aria-hidden="true" class="header-anchor">#</a> 1.dll （动态链接库）打包原理</h2><p><a href="https://blog.csdn.net/suhuaiqiang_janlay/article/details/79715969" target="_blank" rel="noopener noreferrer">彻底解决Webpack打包性能问题——manifest.json<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p><p><strong>问题提出：</strong>
webpack每次打包的时候，无论是改变没改变的都要打包一遍，对于第三方插件或者库来说，打包就做了重复的工作，增加了时间，影响了性能。</p><p><strong>问题试解决：</strong></p><div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    externals<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token string">'react'</span><span class="token punctuation">:</span> <span class="token string">'window.React'</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//其它配置忽略......</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre></div><p>使用externals来将react 这个模块就不要打包啦，直接指向 window.React 就好。不过别忘了加载 react.min.js，让全局中有 React 这个变量。</p><p><strong>问题再出现：</strong></p><p>再加入一个react的相关插件库之后，插件中有require('react')后，打包又会把react再打包一遍；</p><p><strong>问题初级解决：</strong>
手工打包这些 module，然后设置 externals ，让 Webpack 不再打包它们。</p><p>我们需要这样一个 lib-bundle.js 文件：</p><div class="language-js extra-class"><pre class="language-js"><code>
window<span class="token punctuation">.</span>__LIB<span class="token punctuation">[</span><span class="token string">&quot;react&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;react&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
window<span class="token punctuation">.</span>__LIB<span class="token punctuation">[</span><span class="token string">&quot;react-addons-css-transition-group&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;react-addons-css-transition-group&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// ...其它依赖包</span>

</code></pre></div><p>我们在这里把一些第三方库注册到了 window.__LIB 下，这些库可以作为底层的基础库，免于重复打包。</p><p>然后执行</p><div class="language-bash extra-class"><pre class="language-bash"><code>webpack lib-bundle.js lib.js
</code></pre></div><p>得到打包好的 lib.js。然后去设置我们的 externals ：</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
externals<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token string">'react'</span><span class="token punctuation">:</span> <span class="token string">'window.__LIB[&quot;react&quot;]'</span><span class="token punctuation">,</span>
        <span class="token string">'react-addons-css-transition-group'</span><span class="token punctuation">:</span> <span class="token string">'window.__LIB[&quot;react-addons-css-transition-group&quot;]'</span><span class="token punctuation">,</span>
        <span class="token comment">// 其它库</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//其它配置忽略...... </span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>这时由于 externals 的存在，Webpack 打包的时候就会避开这些模块超多，依赖关系复杂的库，把这些第三方 module 的入口指向预先打包好的 lib.js 的入口 window.__LIB，从而只打包我们的业务代码。
<strong>终极解决方法-dll:</strong></p><p>dll----动态链接库。
dll一个纯净的依赖库，本身不能运行，是用来给你的app或者业务代码引用的；</p><p>————webpack.DllPlugin插件</p><ul><li>1.打包dll包</li><li>2.引用dll包，打包业务代码</li></ul><p>首先我们来打包ddl包，首先配置一个这样的 dll.config.js：</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> vendors <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token string">'react'</span><span class="token punctuation">,</span>
    <span class="token string">'react-dom'</span><span class="token punctuation">,</span>
    <span class="token string">'react-router'</span><span class="token punctuation">,</span>
    <span class="token comment">// ...其它库</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    output<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        path<span class="token punctuation">:</span> <span class="token string">'build'</span><span class="token punctuation">,</span>
        filename<span class="token punctuation">:</span> <span class="token string">'[name].js'</span><span class="token punctuation">,</span>
        library<span class="token punctuation">:</span> <span class="token string">'[name]'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    entry<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;lib&quot;</span><span class="token punctuation">:</span> vendors<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DllPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            path<span class="token punctuation">:</span> <span class="token string">'manifest.json'</span><span class="token punctuation">,</span>
            name<span class="token punctuation">:</span> <span class="token string">'[name]'</span><span class="token punctuation">,</span>
            context<span class="token punctuation">:</span> __dirname<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p><code>webpack.DllPlugin</code> 的选项中：</p><ul><li>path 是 manifest.json 文件的输出路径，这个文件会用于后续的业务代码打包；</li><li>name 是 dll 暴露的对象名，要跟 output.library 保持一致；</li><li>context 是解析包路径的上下文，这个要跟接下来配置的 webpack.config.js 一致。
运行Webpack，会输出两个文件一个是打包好的 lib.js，一个就是 manifest.json，它里面的内容大概是这样的：</li></ul><div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
    <span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;vendor_ac51ba426d4f259b8b18&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;content&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;./node_modules/react/react.js&quot;</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token string">&quot;./node_modules/react/lib/React.js&quot;</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
        <span class="token string">&quot;./node_modules/react/node_modules/object-assign/index.js&quot;</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
        <span class="token string">&quot;./node_modules/react/lib/ReactChildren.js&quot;</span><span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
        <span class="token string">&quot;./node_modules/react/lib/PooledClass.js&quot;</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
        <span class="token string">&quot;./node_modules/react/lib/reactProdInvariant.js&quot;</span><span class="token punctuation">:</span> <span class="token number">6</span><span class="token punctuation">,</span>
        <span class="token comment">// ............</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>接下来我们就可以快乐地打包业务代码啦，首先写好打包配置文件 webpack.config.js：</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    output<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        path<span class="token punctuation">:</span> <span class="token string">'build'</span><span class="token punctuation">,</span>
        filename<span class="token punctuation">:</span> <span class="token string">'[name].js'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    entry<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        app<span class="token punctuation">:</span> <span class="token string">'./src/index.js'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DllReferencePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            context<span class="token punctuation">:</span> __dirname<span class="token punctuation">,</span>
            manifest<span class="token punctuation">:</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./manifest.json'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p><code>webpack.DllReferencePlugin</code> 的选项中：</p><ul><li>context 需要跟之前保持一致，这个用来指导 Webpack 匹配 manifest.json 中库的路径；</li><li>manifest 用来引入刚才输出的 manifest.json 文件。</li><li>DllPlugin 本质上的做法和我们手动分离这些第三方库是一样的，但是对于包极多的应用来说，自动化明显加快了生产效率。</li></ul><p>引用<a href="https://blog.csdn.net/suhuaiqiang_janlay/article/details/79715969" target="_blank" rel="noopener noreferrer">彻底解决Webpack打包性能问题——manifest.json<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p><h2 id="_2-node-http起服务"><a href="#_2-node-http起服务" aria-hidden="true" class="header-anchor">#</a> 2. node http起服务</h2><h3 id="http起本地文件服务"><a href="#http起本地文件服务" aria-hidden="true" class="header-anchor">#</a> http起本地文件服务</h3><p>新建文件夹，然后<code>npm init</code></p><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> http<span class="token punctuation">;</span>
<span class="token function">npm</span> <span class="token function">install</span> fs<span class="token punctuation">;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//引入文件读取模块</span>
<span class="token keyword">const</span> request <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'request'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> documentRoot <span class="token operator">=</span> <span class="token string">'/Users/tlm/Documents/web-front/test/keep-study/node-test/'</span><span class="token punctuation">;</span>
<span class="token comment">//需要访问的文件的存放目录（项目所在位置的文件夹路径）</span>

<span class="token keyword">var</span> server <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token keyword">var</span> url <span class="token operator">=</span> req<span class="token punctuation">.</span>url<span class="token punctuation">;</span>
    <span class="token comment">//客户端输入的url，例如如果输入localhost:8888/index.html</span>
    <span class="token comment">//那么这里的url == /index.html </span>

    <span class="token keyword">var</span> file <span class="token operator">=</span> documentRoot <span class="token operator">+</span> url<span class="token punctuation">;</span>


    fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">/*
            一参为文件路径
            二参为回调函数
                回调函数的一参为读取错误返回的信息，返回空就没有错误
                二参为读取成功返回的文本内容
        */</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            res<span class="token punctuation">.</span><span class="token function">writeHeader</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
                <span class="token string">'content-type'</span><span class="token punctuation">:</span> <span class="token string">'text/html;charset=&quot;utf-8&quot;'</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            res<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">'&lt;h1&gt;404错误&lt;/h1&gt;&lt;p&gt;你要找的页面不存在&lt;/p&gt;'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            res<span class="token punctuation">.</span><span class="token function">writeHeader</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
                <span class="token string">'content-type'</span><span class="token punctuation">:</span> <span class="token string">'text/html;charset=&quot;utf-8&quot;'</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            res<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//将index.html显示在客户端</span>
            res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>



<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8010</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'服务器开启成功'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><p>在项目目录下运行</p><div class="language-bash extra-class"><pre class="language-bash"><code>node server.js
</code></pre></div><p>然后就可以像sublime text插件起的服务，或者是vscode中live-server起的服务一样了。
打开页面http://localhost:8010/index.html可用</p><h3 id="http代理服务"><a href="#http代理服务" aria-hidden="true" class="header-anchor">#</a> http代理服务</h3><p>如果直接去访问<code>http://news-at.zhihu.com/api/4/news/before/20190115</code>接口就会报错，跨域，如此我们使用创建http代理（当然nginx代理也可以实现）:</p><p>安装http和request。</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//server.js</span>
<span class="token keyword">var</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> request <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'request'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> hostname <span class="token operator">=</span> <span class="token string">'127.0.0.1'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> port <span class="token operator">=</span> <span class="token number">8010</span><span class="token punctuation">;</span>

<span class="token comment">// 创建一个 API 代理服务</span>
<span class="token keyword">const</span> apiServer <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token string">'http://news-at.zhihu.com/api/4'</span> <span class="token operator">+</span> req<span class="token punctuation">.</span>url<span class="token punctuation">;</span>
    <span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
        url<span class="token punctuation">:</span> url
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token keyword">function</span> <span class="token function">callback</span><span class="token punctuation">(</span>error<span class="token punctuation">,</span> response<span class="token punctuation">,</span> body<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>error <span class="token operator">&amp;&amp;</span> response<span class="token punctuation">.</span>statusCode <span class="token operator">===</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 设置编码类型，否则中文会显示为乱码</span>
            res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">'Content-Type'</span><span class="token punctuation">,</span> <span class="token string">'text/plain;charset=UTF-8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 设置所有域允许跨域</span>
            res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">'Access-Control-Allow-Origin'</span><span class="token punctuation">,</span> <span class="token string">'*'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 返回代理后的内容</span>
            res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    request<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span>options<span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 监听 8010 端口</span>
apiServer<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> hostname<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`接口代理运行在 http://</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>hostname<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>在项目目录下运行</p><div class="language-bash extra-class"><pre class="language-bash"><code>node server.js
</code></pre></div><p>此时就有一个代理接口可用了，此时发起请求可用。</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// jquery发起ajax请求</span>
$<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    url<span class="token punctuation">:</span><span class="token string">'http://127.0.0.1:8010/news/before/20190115'</span><span class="token punctuation">,</span>
    success<span class="token punctuation">:</span><span class="token keyword">function</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    error<span class="token punctuation">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><blockquote><p>说明:这两个服务一个是本地的文件，一个是代理接口，所以同时可同时写在一个server.js。同时启动服务可用。</p></blockquote><hr><blockquote><p>疑问： 如果代理接口监听的是localhost就请求不存在（404）。而hostname为127.0.0.1的时候就可以用，是不能和本地服务一个端口吗？
果然，换了代理监听的端口不论是localhost还是127.0.0.1都可以请求成功。<code>url:'http://localhost:8011/news/before/20190115'</code></p></blockquote><hr><blockquote><p><strong>疑问：</strong> 为何我用express起的后台服务，代理转接却请求不到呢？要不404，要不就一直pending到fail。</p></blockquote><blockquote><p>问题解决：之前一直express一直用的8081，换了8088后，就可以了，（端口已经被占用了？）；
本地文件服务为<code>localhost:8010/index.html</code>, express起服务为<code>localhost:8080/list_user</code>,代理转接监听接口为<code>http://127.0.0.1:8011/list_user</code>,ajax请求时，url为<code>http://127.0.0.1:8011/list_user</code>,请求成功。（node server.js;node express/express_demo2.js)</p></blockquote><h3 id="基础知识补充"><a href="#基础知识补充" aria-hidden="true" class="header-anchor">#</a> 基础知识补充</h3><p>node http server中有个函数<code>http.createServer(function(req,res)){}</code>；
第一个参数是请求，第二个是响应。</p><p>一个非常简单的http服务：</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> apiServer <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
   res<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'Content-type'</span> <span class="token punctuation">:</span> <span class="token string">'text/html'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   res<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">'1414124'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">'&lt;p&gt;Hello World&lt;/p&gt;'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8010</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>请求头没有进行设置，只有响应，http状态码为200，{'Content-Type':'text-plain'}这个是个MIME标准的格式描述。 内容直接输出到页面上。</p><p>读取文件输出需要fs:</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//引入文件读取模块</span>

<span class="token keyword">const</span> apiServer <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'data1.js'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token function">readData</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        res<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'Content-Type'</span><span class="token punctuation">:</span> <span class="token string">'text/plain'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8010</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>发送请求http.request(options[, callback])：
第一个参数为请求头选项，既主机名、域名、端口、请求方式、资源路径等等；</p><p>第二个参数为请求成功的回调函数；</p><blockquote><p>这个节奏怎么成了node的http了，暂停，以后学习node时再继续研究吧。</p></blockquote><h2 id="_3-express起服务"><a href="#_3-express起服务" aria-hidden="true" class="header-anchor">#</a> 3. express起服务</h2><p>参考：<a href="http://www.runoob.com/nodejs/nodejs-express-framework.html" target="_blank" rel="noopener noreferrer">Node.js Express 框架<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p><p>Express 是一个简洁而灵活的 node.js Web应用框架, 提供了一系列强大特性帮助你创建各种 Web 应用，和丰富的 HTTP 工具。</p><p>使用 Express 可以快速地搭建一个完整功能的网站。</p><p>Express 框架核心特性：</p><ul><li><p>可以设置中间件来响应 HTTP 请求。</p></li><li><p>定义了路由表用于执行不同的 HTTP 请求动作。</p></li><li><p>可以通过向模板传递参数来动态渲染 HTML 页面。</p></li></ul><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> express --save

<span class="token function">npm</span> <span class="token function">install</span> body-parser --save //node.js 中间件，用于处理 JSON, Raw, Text 和 URL 编码的数据。
<span class="token function">npm</span> <span class="token function">install</span> cookie-parser --save // 这就是一个解析Cookie的工具。通过req.cookies可以取到传过来的cookie，并把它们转成对象。
<span class="token function">npm</span> <span class="token function">install</span> multer --save // node.js 中间件，用于处理 enctype<span class="token operator">=</span><span class="token string">&quot;multipart/form-data&quot;</span>（设置表单的MIME编码）的表单数据
</code></pre></div><p>整篇实例都借鉴于菜鸟教程中的：</p><h4 id="基本写法："><a href="#基本写法：" aria-hidden="true" class="header-anchor">#</a> 基本写法：</h4><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//express_demo.js 文件</span>
<span class="token keyword">var</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Hello World'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">var</span> server <span class="token operator">=</span> app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8081</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token keyword">var</span> host <span class="token operator">=</span> server<span class="token punctuation">.</span><span class="token function">address</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>address
  <span class="token keyword">var</span> port <span class="token operator">=</span> server<span class="token punctuation">.</span><span class="token function">address</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>port

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;应用实例，访问地址为 http://%s:%s&quot;</span><span class="token punctuation">,</span> host<span class="token punctuation">,</span> port<span class="token punctuation">)</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="可以配置不同的路由来实现不同的接口url：app-get-list"><a href="#可以配置不同的路由来实现不同的接口url：app-get-list" aria-hidden="true" class="header-anchor">#</a> 可以配置不同的路由来实现不同的接口url：<code>app.get('/list'...</code></h4><h4 id="静态文件调用使用app-use-express-static-public-pubilc目录下面的图片、页面等静态文件就可以访问了"><a href="#静态文件调用使用app-use-express-static-public-pubilc目录下面的图片、页面等静态文件就可以访问了" aria-hidden="true" class="header-anchor">#</a> 静态文件调用使用<code>app.use(express.static('public'));</code>pubilc目录下面的图片、页面等静态文件就可以访问了</h4><blockquote><p>此时在public中的index.html中的请求，就可以不使用代理来访问express起的服务的接口了。当然代理转接也可以成功</p></blockquote><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// http://localhost:8088/index.html</span>
$<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token comment">// url:'http://127.0.0.1:8011/list_user',</span>
    url<span class="token punctuation">:</span><span class="token string">'http://localhost:8088/list_user'</span><span class="token punctuation">,</span>
    type<span class="token punctuation">:</span><span class="token string">'get'</span><span class="token punctuation">,</span>
    data<span class="token punctuation">:</span> <span class="token punctuation">{</span>a<span class="token punctuation">:</span><span class="token number">11</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    success<span class="token punctuation">:</span><span class="token keyword">function</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    error<span class="token punctuation">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>图片目录为<code>/public/images/dog.jpg</code>
访问图片及<code>http://localhost:8088/images/dog.jpg</code></p><h4 id="获取客户端请求的参数是req-query"><a href="#获取客户端请求的参数是req-query" aria-hidden="true" class="header-anchor">#</a> 获取客户端请求的参数是<code>req.query</code></h4><h4 id="需注意在根目录下启动express，否则pubilc中的内容起不起来node-express-express-server-js"><a href="#需注意在根目录下启动express，否则pubilc中的内容起不起来node-express-express-server-js" aria-hidden="true" class="header-anchor">#</a> 需注意在根目录下启动express，否则pubilc中的内容起不起来<code>node express/express_server.js</code></h4><h4 id="app-get-app-post"><a href="#app-get-app-post" aria-hidden="true" class="header-anchor">#</a> app.get(),app.post()</h4><p>post请求需要：</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> bodyParser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'body-parser'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 创建 application/x-www-form-urlencoded 编码解析</span>
<span class="token keyword">var</span> urlencodedParser <span class="token operator">=</span> bodyParser<span class="token punctuation">.</span><span class="token function">urlencoded</span><span class="token punctuation">(</span><span class="token punctuation">{</span> extended<span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/process_post'</span><span class="token punctuation">,</span> urlencodedParser<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>// 实践证明下面这句代码不写也是可以的</p><div class="language-js extra-class"><pre class="language-js"><code>app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/indexpost.htm'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   res<span class="token punctuation">.</span><span class="token function">sendFile</span><span class="token punctuation">(</span> __dirname <span class="token operator">+</span> <span class="token string">&quot;/&quot;</span> <span class="token operator">+</span> <span class="token string">&quot;indexpost.htm&quot;</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="文件上传"><a href="#文件上传" aria-hidden="true" class="header-anchor">#</a> 文件上传</h4><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;fs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> bodyParser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'body-parser'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> multer  <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'multer'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>bodyParser<span class="token punctuation">.</span><span class="token function">urlencoded</span><span class="token punctuation">(</span><span class="token punctuation">{</span> extended<span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">multer</span><span class="token punctuation">(</span><span class="token punctuation">{</span> dest<span class="token punctuation">:</span> <span class="token string">'/tmp/'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">array</span><span class="token punctuation">(</span><span class="token string">'image'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/file_upload'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token punctuation">{</span>

   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 上传的文件信息</span>

   <span class="token keyword">var</span> des_file <span class="token operator">=</span> __dirname <span class="token operator">+</span> <span class="token string">&quot;/&quot;</span> <span class="token operator">+</span> req<span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>originalname<span class="token punctuation">;</span>
   fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span> req<span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>path<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        fs<span class="token punctuation">.</span><span class="token function">writeFile</span><span class="token punctuation">(</span>des_file<span class="token punctuation">,</span> data<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span> err <span class="token punctuation">)</span><span class="token punctuation">{</span>
              console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> err <span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
               response <span class="token operator">=</span> <span class="token punctuation">{</span>
                   message<span class="token punctuation">:</span><span class="token string">'File uploaded successfully'</span><span class="token punctuation">,</span>
                   filename<span class="token punctuation">:</span>req<span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>originalname
              <span class="token punctuation">}</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> response <span class="token punctuation">)</span><span class="token punctuation">;</span>
          res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span> response <span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre></div><h4 id="cookie管理"><a href="#cookie管理" aria-hidden="true" class="header-anchor">#</a> cookie管理</h4><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//  获取客户端的cookie信息</span>
<span class="token keyword">var</span> express      <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> cookieParser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'cookie-parser'</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> util <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'util'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">cookieParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Cookies: &quot;</span> <span class="token operator">+</span> util<span class="token punctuation">.</span><span class="token function">inspect</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>cookies<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8081</span><span class="token punctuation">)</span>
</code></pre></div><blockquote><p>后言： 由于在vue或者react的项目中都有webpack搭建的服务，所以转而想看一下这些服务稍微往前一点的使用，所以就进行了简单的查询，并跟着实践一遍，理解还不透彻，但是也算了解了。后面有时间深入node。。。</p></blockquote></div><div class="content edit-link"><!----><!----></div><div class="content page-nav"><p class="inner"><span class="prev">
        ← <a href="/my-blog/frontEnd/front-daily/webpack-fe-ml.html" class="prev">
          cytoscape-fe-ml webpack配置理解
        </a></span><span class="next"><a href="/my-blog/frontEnd/vue/">
          first与vue亲密接触
        </a> →
      </span></p></div></div></div></div>
    <script src="/my-blog/assets/js/28.52366dcf.js" defer></script><script src="/my-blog/assets/js/app.c2d9e473.js" defer></script>
  </body>
</html>
